---
import { Image } from "astro:assets";
import { resolveImagePath } from "../../utils/assets.ts";
import Placeholder from "../../assets/icons/Placeholder.astro";

interface Props {
  resource: {
    title: string;
    slug: string;
    description: string;
    resourceType: string;
    category: string;
    featuredImage?: string;
    fileUrl: string;
    featured?: boolean;
  };
  t: any;
}

const { resource, t } = Astro.props;

const typeLabels = {
  pdf: "PDF",
  audio: "Audio",
  video: "Video",
  link: "Link",
};

const processedImage = resource.featuredImage
  ? resolveImagePath(resource.featuredImage)
  : null;
---

<article class="resource-card">
  {resource.featured && (
    <div class="featured-badge">Featured</div>
  )}

  <div class="resource-image hover-image-animation">
    {processedImage ? (
      <figure>
        <Image
          src={processedImage}
          alt={resource.title}
          inferSize={true}
          loading="lazy"
          format="webp"
        />
      </figure>
    ) : (
      <div class="placeholder flex-center">
        <Placeholder />
      </div>
    )}
  </div>

  <div class="resource-content">
    <div class="resource-meta">
      <span class="resource-type">
        <svg class="type-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          {resource.resourceType === 'pdf' && (
            <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2ZM18 20H6V4H13V9H18V20ZM10 17H8V11H10C10.5304 11 11.0391 11.2107 11.4142 11.5858C11.7893 11.9609 12 12.4696 12 13V15C12 15.5304 11.7893 16.0391 11.4142 16.4142C11.0391 16.7893 10.5304 17 10 17ZM10 13V15ZM14 17V11H16V17H14Z" fill="currentColor"/>
          )}
          {resource.resourceType === 'audio' && (
            <path d="M12 3C13.5 3 16.5 4 17 4.5C17.5 5 18 5.5 18 7V15C18 16.5 17 17.5 15.5 18C14 18.5 12.5 19 12 19C11.5 19 10 18.5 8.5 18C7 17.5 6 16.5 6 15V7C6 5.5 6.5 5 7 4.5C7.5 4 10.5 3 12 3ZM12 5C10.5 5 8.5 5.5 8 6V15C8 15.5 8.5 16 9.5 16.5C10.5 17 11.5 17 12 17C12.5 17 13.5 17 14.5 16.5C15.5 16 16 15.5 16 15V6C15.5 5.5 13.5 5 12 5ZM10 8H14V10H10V8ZM10 11H14V13H10V11Z" fill="currentColor"/>
          )}
          {resource.resourceType === 'video' && (
            <path d="M17 10.5L22 7V17L17 13.5V19C17 19.5304 16.7893 20.0391 16.4142 20.4142C16.0391 20.7893 15.5304 21 15 21H3C2.46957 21 1.96086 20.7893 1.58579 20.4142C1.21071 20.0391 1 19.5304 1 19V5C1 4.46957 1.21071 3.96086 1.58579 3.58579C1.96086 3.21071 2.46957 3 3 3H15C15.5304 3 16.0391 3.21071 16.4142 3.58579C16.7893 3.96086 17 4.46957 17 5V10.5ZM15 5H3V19H15V5Z" fill="currentColor"/>
          )}
          {resource.resourceType === 'link' && (
            <path d="M10.59 13.41C11 13.8 11 14.44 10.59 14.83C9.5 15.92 7.75 15.92 6.66 14.83L3.51 11.68C2.42 10.59 2.42 8.84 3.51 7.75C4.6 6.66 6.35 6.66 7.44 7.75L8.97 9.28C9.18 9.49 9.5 9.49 9.71 9.28C9.92 9.07 9.92 8.75 9.71 8.54L8.18 7.01C6.55 5.38 3.93 5.38 2.3 7.01C0.67 8.64 0.67 11.26 2.3 12.89L5.45 16.04C7.08 17.67 9.7 17.67 11.33 16.04C12.22 15.15 12.22 13.69 11.33 12.8C11.12 12.59 10.8 12.59 10.59 12.8ZM20.49 11.68L17.34 8.53C15.71 6.9 13.09 6.9 11.46 8.53C10.57 9.42 10.57 10.88 11.46 11.77C11.67 11.98 11.99 11.98 12.2 11.77C12.41 11.56 12.41 11.24 12.2 11.03C11.79 10.62 11.79 9.98 12.2 9.59C13.29 8.5 15.04 8.5 16.13 9.59L19.28 12.74C20.37 13.83 20.37 15.58 19.28 16.67C18.19 17.76 16.44 17.76 15.35 16.67L13.82 15.14C13.61 14.93 13.29 14.93 13.08 15.14C12.87 15.35 12.87 15.67 13.08 15.88L14.61 17.41C16.24 19.04 18.86 19.04 20.49 17.41C22.12 15.78 22.12 13.16 20.49 11.68Z" fill="currentColor"/>
          )}
        </svg>
        <span class="type-label">{typeLabels[resource.resourceType]}</span>
      </span>
      <span class="resource-category">{resource.category}</span>
    </div>

    <h3 class="resource-title">{resource.title}</h3>
    <p class="resource-description">{resource.description}</p>

    <div class="resource-actions">
      <a
        href={resource.fileUrl}
        download={resource.resourceType === 'pdf' || resource.resourceType === 'audio'}
        target={resource.resourceType === 'link' ? '_blank' : undefined}
        rel={resource.resourceType === 'link' ? 'noopener noreferrer' : undefined}
        class="download-button"
      >
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M10 13L6 9L7.4 7.55L9 9.15V3H11V9.15L12.6 7.55L14 9L10 13ZM5 17C4.45 17 3.979 16.804 3.587 16.412C3.195 16.020 2.99934 15.5493 3 15V12H5V15H15V12H17V15C17 15.55 16.804 16.021 16.412 16.413C16.020 16.805 15.5493 17.0007 15 17H5Z" fill="currentColor"/>
        </svg>
        <span>{resource.resourceType === 'link' ? 'Open Link' : `Download ${typeLabels[resource.resourceType]}`}</span>
      </a>
    </div>
  </div>
</article>

<style>
  .resource-card {
    background: var(--color-card-bg, #ffffff);
    border-radius: max(12px, calc(0.83vw * var(--scale, 1)));
    overflow: hidden;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    position: relative;
    border: 1px solid var(--color-border, #e5e7eb);
  }

  .resource-card:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .featured-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    background: var(--color-accent, #6366f1);
    color: white;
    padding: 4px 12px;
    border-radius: max(100px, calc(6.94vw * var(--scale, 1)));
    font-size: 0.75rem;
    font-weight: 600;
    z-index: 1;
  }

  .resource-image {
    aspect-ratio: 16/9;
    overflow: hidden;
    background: var(--color-surface, #f9fafb);
    position: relative;
  }

  .resource-image figure,
  .resource-image .placeholder {
    width: 100%;
    height: 100%;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .resource-image img,
  .resource-image svg {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transform: scale(1);
    will-change: transform;
    transition: transform 1s var(--ease-transition, cubic-bezier(0.4, 0, 0.2, 1));
  }

  .resource-image:hover img,
  .resource-image:hover svg {
    transform: scale(1.02);
  }

  .resource-image .placeholder {
    background: var(--color-surface, #f9fafb);
  }

  .resource-image .placeholder svg {
    width: 60px;
    height: 60px;
    opacity: 0.3;
  }

  .resource-content {
    padding: 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .resource-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    font-size: 0.875rem;
  }

  .resource-type {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 500;
  }

  .type-icon {
    width: 20px;
    height: 20px;
    color: var(--color-primary, #000000);
  }

  .resource-category {
    color: var(--color-text-muted, #6b7280);
  }

  .resource-title {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
    line-height: 1.3;
    color: var(--color-text, #111827);
  }

  .resource-description {
    color: var(--color-text-secondary, #4b5563);
    line-height: 1.6;
    margin-bottom: 1.5rem;
    flex: 1;
  }

  .resource-actions {
    margin-top: auto;
  }

  .download-button {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: var(--color-surface, #f3f4f6);
    color: var(--color-text, #111827);
    border: 2px solid var(--color-border, #e5e7eb);
    border-radius: max(100px, calc(6.94vw * var(--scale, 1)));
    font-weight: 500;
    text-decoration: none;
    text-transform: uppercase;
    font-size: 0.875rem;
    letter-spacing: 0.025em;
    transition: background 0.15s ease-out, border-color 0.15s ease-out, color 0.15s ease-out;
  }

  .download-button:hover {
    background: var(--color-primary, #000000);
    border-color: var(--color-primary, #000000);
    color: white;
  }
</style>
