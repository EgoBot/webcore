---
import Placeholder from "../assets/icons/Placeholder.astro";
import type { PostCardProps } from "@src-types/types";
import { formatDate, slugify, resolveImagePath } from "@utils/utils";
import { Image } from "astro:assets";

import "@styles/post-card.css";

const t = Astro.props.t;

const { post } = Astro.props as PostCardProps;

const formatted_date = formatDate(post.data.pub_date);

const topics = (post.data.topics || [])
  .slice(0, 2)
  .map(topicName => ({
    name: topicName,
    slug: slugify(topicName)
}));

const authors = (post.data.authors || []).map(authorName => ({
  name: authorName,
  slug: slugify(authorName)
}));

const processedImage = resolveImagePath(post.data.feature_image);
---

<div class="card">
    <a href={`/blog/${post.id}`} class="card-image-wrapper hover-image-animation" aria-label={post.data.title}>
        {processedImage ? (
            <figure>
                <Image
                    class="card-image-inner"
                    src={processedImage}
                    alt={post.data.title}
                    inferSize={true}
                    loading="lazy"
                    format="webp"
                    widths={[300, 400, 600, 800, 1000, 1200, 1600, 2000, 2400, 2800]}
                    sizes="(max-width: 479px) 260px, (max-width: 1080px) calc(66vw - 56px), 33vw"
                />
            </figure>
        ) : (
            <div class="placeholder flex-center">
                <Placeholder/>
            </div>
        )}
    </a>

    <div class="card-content">
        <div class="card-top">
            {topics.map(topic => (
                <a href={`/topics/${topic.slug}`} class="bracket-button">
                    <div class="medium-text left-bracket">{t.global.bracket}</div>
                    <div class="bracket-button-text">
                        <div class="medium-text main">{topic.name}</div>
                        <div class="medium-text absolute">{topic.name}</div>
                    </div>
                    <div class="medium-text right-bracket">{t.global.bracket}</div>
                </a>
            ))}
        </div>

        <div class="card-title-and-circle-wrapper">
            <div class="card-circle"></div>
            <div class="card-title-wrapper">
                <a href={`/blog/${post.id}`} class="medium-text card-text">
                    {post.data.title}
                </a>
            </div>
        </div>

        <div class="card-excerpt">
            <p class="paragraph three-lines">
                {post.data.excerpt}
            </p>
        </div>

        <div class="card-extra-info card-small-text">
            <p class="paragraph">
                <span>
                    {t.global.by}
                    {authors.map((author, index) => {
                        const isLast = index === authors.length - 1;

                        return (                                                    
                            <a href={`/authors/${author.slug}`}>{author.name}</a><>{!isLast ? " & " : ","}</>
                        );
                    })}
                </span>
                <span>
                    {formatted_date}
                </span>
            </p>
        </div>
    </div>
</div>